
user nginx;
worker_processes auto;

error_log /var/log/nginx/error.log notice;
pid /var/run/nginx.pid;

events {
  worker_connections 1024;
}

http {
  include /etc/nginx/mime.types;
  default_type application/octet-stream;
  server_tokens off;

  log_format main '$remote_addr - $remote_user [$time_local] "$request" '
  '$status $body_bytes_sent "$http_referer" '
  '"$http_user_agent" "$http_x_forwarded_for"';

  access_log /var/log/nginx/access.log main;

  sendfile on;
  #tcp_nopush     on;

  keepalive_timeout 65;

  gzip  on;

  server {
      listen 80;
      listen [::]:80;
      server_name _;
      return 301 https://$host$request_uri;
  }

  server {

    server_name _ ;
    include ssl.conf;
    root {{.Values.services.nginx.public_path }}404;
    error_page 404 /index.html;
    location /index.html {
      internal;
    }
    location / {
      try_files $uri $uri/ =404;
    }
  }

  server {
    server_name plex.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    listen 32400 http2 ssl;
    listen [::]:32400 http2 ssl;
    location / {
      proxy_pass http://plex:32400;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name router.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass "https://{{ .Values.common.network.gateway }}";
      include nginx_proxy_headers.conf;
    }
  }


  server {
    server_name homepage.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://homepage:3000;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name torrent.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://qbittorrent:8080;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name sonarr.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://sonarr:8989;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name radarr.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://radarr:7878;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name irc.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://thelounge:9000;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name autobrr.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://autobrr:7474;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name jackett.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://jackett:9117;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name sabnzbd.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://sabnzbd:8080;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name overseerr.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://overseerr:5055;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name tautulli.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://tautulli:8181;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name huginn.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://huginn:3000;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name gotify.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://gotify:80;
      include nginx_proxy_headers.conf;
    }
  }

  server {
    server_name changedetectionio.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://changedetectionio:5000;
      include nginx_proxy_headers.conf;
    }
  }

{{- if .Values.services.apprise.enabled }}
  server {
    server_name apprise.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://apprise:8000;
      include nginx_proxy_headers.conf;
    }
  }
{{- end }}

{{- if .Values.services.playwright.enabled }}
  server {
    server_name playwright.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://playwright:3000;
      include nginx_proxy_headers.conf;
    }
  }
{{- end }}

{{- if .Values.services.kavita.enabled }}
  server {
    server_name kavita.{{ .Values.services.nginx.domain }};
    include ssl.conf;
    location / {
      proxy_pass http://kavita:5000;
      include nginx_proxy_headers.conf;
    }
  }
{{- end }}


}